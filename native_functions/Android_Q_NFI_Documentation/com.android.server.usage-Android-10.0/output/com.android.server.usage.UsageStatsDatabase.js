Ext.data.JsonP.com_android_server_usage_UsageStatsDatabase({"tagname":"class","name":"com.android.server.usage.UsageStatsDatabase","autodetected":{},"files":[{"filename":"UsageStatsDatabase.js","href":"UsageStatsDatabase.html#com-android-server-usage-UsageStatsDatabase"}],"extends":"java.lang.Object","members":[{"name":"checkinDailyFiles","tagname":"method","owner":"com.android.server.usage.UsageStatsDatabase","id":"method-checkinDailyFiles","meta":{}},{"name":"dump","tagname":"method","owner":"com.android.server.usage.UsageStatsDatabase","id":"method-dump","meta":{}},{"name":"findBestFitBucket","tagname":"method","owner":"com.android.server.usage.UsageStatsDatabase","id":"method-findBestFitBucket","meta":{}},{"name":"getLatestUsageStats","tagname":"method","owner":"com.android.server.usage.UsageStatsDatabase","id":"method-getLatestUsageStats","meta":{}},{"name":"init","tagname":"method","owner":"com.android.server.usage.UsageStatsDatabase","id":"method-init","meta":{}},{"name":"onTimeChanged","tagname":"method","owner":"com.android.server.usage.UsageStatsDatabase","id":"method-onTimeChanged","meta":{}},{"name":"prune","tagname":"method","owner":"com.android.server.usage.UsageStatsDatabase","id":"method-prune","meta":{}},{"name":"putUsageStats","tagname":"method","owner":"com.android.server.usage.UsageStatsDatabase","id":"method-putUsageStats","meta":{}},{"name":"queryUsageStats","tagname":"method","owner":"com.android.server.usage.UsageStatsDatabase","id":"method-queryUsageStats","meta":{}}],"alternateClassNames":[],"aliases":{},"id":"class-com.android.server.usage.UsageStatsDatabase","short_doc":"Provides an interface to query for UsageStat data from a Protocol Buffer database. ...","classIcon":"icon-class","superclasses":["java.lang.Object"],"subclasses":[],"mixedInto":[],"mixins":[],"parentMixins":[],"requires":[],"uses":[],"html":"<div><pre class=\"hierarchy\"><h4>Hierarchy</h4><div class='subclass first-child'>java.lang.Object<div class='subclass '><strong>com.android.server.usage.UsageStatsDatabase</strong></div></div><h4>Files</h4><div class='dependency'><a href='source/UsageStatsDatabase.html#com-android-server-usage-UsageStatsDatabase' target='_blank'>UsageStatsDatabase.js</a></div></pre><div class='doc-contents'><p>Provides an interface to query for UsageStat data from a Protocol Buffer database.</p>\n\n<p> Prior to version 4, UsageStatsDatabase used XML to store Usage Stats data to disk.\n When the UsageStatsDatabase version is upgraded, the files on disk are migrated to the new\n version on init. The steps of migration are as follows:\n 1) Check if version upgrade breadcrumb exists on disk, if so skip to step 4.\n 2) Move current files to a timestamped backup directory.\n 3) Write a temporary breadcrumb file with some info about the backup directory.\n 4) Deserialize the backup files in the timestamped backup folder referenced by the breadcrumb.\n 5) Reserialize the data read from the file with the new version format and replace the old files\n 6) Repeat Step 3 and 4 for each file in the backup folder.\n 7) Update the version file with the new version and build fingerprint.\n 8) Delete the time stamped backup folder (unless flagged to be kept).\n 9) Delete the breadcrumb file.</p>\n\n<p> Performing the upgrade steps in this order, protects against unexpected shutdowns mid upgrade</p>\n\n<p> The backup directory will contain directories with timestamp names. If the upgrade breadcrumb\n exists on disk, it will contain a timestamp which will match one of the backup directories. The\n breadcrumb will also contain a version number which will denote how the files in the backup\n directory should be deserialized.</p>\n</div><div class='members'><div class='members-section'><div class='definedBy'>Defined By</div><h3 class='members-title icon-method'>Methods</h3><div class='subsection'><div id='method-checkinDailyFiles' class='member first-child not-inherited'><a href='#' class='side expandable'><span>&nbsp;</span></a><div class='title'><div class='meta'><span class='defined-in' rel='com.android.server.usage.UsageStatsDatabase'>com.android.server.usage.UsageStatsDatabase</span><br/><a href='source/UsageStatsDatabase.html#com-android-server-usage-UsageStatsDatabase-method-checkinDailyFiles' target='_blank' class='view-source'>view source</a></div><a href='#!/api/com.android.server.usage.UsageStatsDatabase-method-checkinDailyFiles' class='name expandable'>checkinDailyFiles</a>( <span class='pre'>checkinAction</span> ) : Boolean<span class=\"signature\"></span></div><div class='description'><div class='short'>Calls com.android.server.usage.UsageStatsDatabase.CheckinAction.checkin(IntervalStats) on the given com.android.serve...</div><div class='long'><p>Calls com.android.server.usage.UsageStatsDatabase.CheckinAction.checkin(IntervalStats) on the given <a href=\"#!/api/com.android.server.usage.UsageStatsDatabase.CheckinAction\" rel=\"com.android.server.usage.UsageStatsDatabase.CheckinAction\" class=\"docClass\">com.android.server.usage.UsageStatsDatabase.CheckinAction</a>\n for all <a href=\"#!/api/com.android.server.usage.IntervalStats\" rel=\"com.android.server.usage.IntervalStats\" class=\"docClass\">com.android.server.usage.IntervalStats</a> that haven't been checked-in.\n If any of the calls to com.android.server.usage.UsageStatsDatabase.CheckinAction.checkin(IntervalStats) returns false or throws\n an exception, the check-in will be aborted.</p>\n<h3 class=\"pa\">Parameters</h3><ul><li><span class='pre'>checkinAction</span> : Object {UsageStatsDatabase.CheckinAction}<div class='sub-desc'><p>The callback to run when checking-in IntervalStats.</p>\n</div></li></ul><h3 class='pa'>Returns</h3><ul><li><span class='pre'>Boolean</span><div class='sub-desc'><p>true if the check-in succeeded.</p>\n</div></li></ul></div></div></div><div id='method-dump' class='member  not-inherited'><a href='#' class='side expandable'><span>&nbsp;</span></a><div class='title'><div class='meta'><span class='defined-in' rel='com.android.server.usage.UsageStatsDatabase'>com.android.server.usage.UsageStatsDatabase</span><br/><a href='source/UsageStatsDatabase.html#com-android-server-usage-UsageStatsDatabase-method-dump' target='_blank' class='view-source'>view source</a></div><a href='#!/api/com.android.server.usage.UsageStatsDatabase-method-dump' class='name expandable'>dump</a>( <span class='pre'>pw</span> )<span class=\"signature\"></span></div><div class='description'><div class='short'>print total number and list of stats files for each interval type. ...</div><div class='long'><p>print total number and list of stats files for each interval type.</p>\n<h3 class=\"pa\">Parameters</h3><ul><li><span class='pre'>pw</span> : Object {IndentingPrintWriter}<div class='sub-desc'>\n</div></li></ul></div></div></div><div id='method-findBestFitBucket' class='member  not-inherited'><a href='#' class='side expandable'><span>&nbsp;</span></a><div class='title'><div class='meta'><span class='defined-in' rel='com.android.server.usage.UsageStatsDatabase'>com.android.server.usage.UsageStatsDatabase</span><br/><a href='source/UsageStatsDatabase.html#com-android-server-usage-UsageStatsDatabase-method-findBestFitBucket' target='_blank' class='view-source'>view source</a></div><a href='#!/api/com.android.server.usage.UsageStatsDatabase-method-findBestFitBucket' class='name expandable'>findBestFitBucket</a>( <span class='pre'></span> )<span class=\"signature\"></span></div><div class='description'><div class='short'>Find the interval that best matches this range. ...</div><div class='long'><p>Find the interval that best matches this range.</p>\n\n<p> TODO(adamlesinski): Use endTimeStamp in best fit calculation.</p>\n</div></div></div><div id='method-getLatestUsageStats' class='member  not-inherited'><a href='#' class='side expandable'><span>&nbsp;</span></a><div class='title'><div class='meta'><span class='defined-in' rel='com.android.server.usage.UsageStatsDatabase'>com.android.server.usage.UsageStatsDatabase</span><br/><a href='source/UsageStatsDatabase.html#com-android-server-usage-UsageStatsDatabase-method-getLatestUsageStats' target='_blank' class='view-source'>view source</a></div><a href='#!/api/com.android.server.usage.UsageStatsDatabase-method-getLatestUsageStats' class='name expandable'>getLatestUsageStats</a>( <span class='pre'></span> )<span class=\"signature\"></span></div><div class='description'><div class='short'>Get the latest stats that exist for this interval type. ...</div><div class='long'><p>Get the latest stats that exist for this interval type.</p>\n</div></div></div><div id='method-init' class='member  not-inherited'><a href='#' class='side expandable'><span>&nbsp;</span></a><div class='title'><div class='meta'><span class='defined-in' rel='com.android.server.usage.UsageStatsDatabase'>com.android.server.usage.UsageStatsDatabase</span><br/><a href='source/UsageStatsDatabase.html#com-android-server-usage-UsageStatsDatabase-method-init' target='_blank' class='view-source'>view source</a></div><a href='#!/api/com.android.server.usage.UsageStatsDatabase-method-init' class='name expandable'>init</a>( <span class='pre'></span> )<span class=\"signature\"></span></div><div class='description'><div class='short'>Initialize any directories required and index what stats are available. ...</div><div class='long'><p>Initialize any directories required and index what stats are available.</p>\n</div></div></div><div id='method-onTimeChanged' class='member  not-inherited'><a href='#' class='side expandable'><span>&nbsp;</span></a><div class='title'><div class='meta'><span class='defined-in' rel='com.android.server.usage.UsageStatsDatabase'>com.android.server.usage.UsageStatsDatabase</span><br/><a href='source/UsageStatsDatabase.html#com-android-server-usage-UsageStatsDatabase-method-onTimeChanged' target='_blank' class='view-source'>view source</a></div><a href='#!/api/com.android.server.usage.UsageStatsDatabase-method-onTimeChanged' class='name expandable'>onTimeChanged</a>( <span class='pre'></span> )<span class=\"signature\"></span></div><div class='description'><div class='short'> ...</div><div class='long'>\n</div></div></div><div id='method-prune' class='member  not-inherited'><a href='#' class='side expandable'><span>&nbsp;</span></a><div class='title'><div class='meta'><span class='defined-in' rel='com.android.server.usage.UsageStatsDatabase'>com.android.server.usage.UsageStatsDatabase</span><br/><a href='source/UsageStatsDatabase.html#com-android-server-usage-UsageStatsDatabase-method-prune' target='_blank' class='view-source'>view source</a></div><a href='#!/api/com.android.server.usage.UsageStatsDatabase-method-prune' class='name expandable'>prune</a>( <span class='pre'></span> )<span class=\"signature\"></span></div><div class='description'><div class='short'>Remove any usage stat files that are too old. ...</div><div class='long'><p>Remove any usage stat files that are too old.</p>\n</div></div></div><div id='method-putUsageStats' class='member  not-inherited'><a href='#' class='side expandable'><span>&nbsp;</span></a><div class='title'><div class='meta'><span class='defined-in' rel='com.android.server.usage.UsageStatsDatabase'>com.android.server.usage.UsageStatsDatabase</span><br/><a href='source/UsageStatsDatabase.html#com-android-server-usage-UsageStatsDatabase-method-putUsageStats' target='_blank' class='view-source'>view source</a></div><a href='#!/api/com.android.server.usage.UsageStatsDatabase-method-putUsageStats' class='name expandable'>putUsageStats</a>( <span class='pre'></span> )<span class=\"signature\"></span></div><div class='description'><div class='short'>Update the stats in the database. ...</div><div class='long'><p>Update the stats in the database. They may not be written to disk immediately.</p>\n</div></div></div><div id='method-queryUsageStats' class='member  not-inherited'><a href='#' class='side expandable'><span>&nbsp;</span></a><div class='title'><div class='meta'><span class='defined-in' rel='com.android.server.usage.UsageStatsDatabase'>com.android.server.usage.UsageStatsDatabase</span><br/><a href='source/UsageStatsDatabase.html#com-android-server-usage-UsageStatsDatabase-method-queryUsageStats' target='_blank' class='view-source'>view source</a></div><a href='#!/api/com.android.server.usage.UsageStatsDatabase-method-queryUsageStats' class='name expandable'>queryUsageStats</a>( <span class='pre'></span> )<span class=\"signature\"></span></div><div class='description'><div class='short'>Find all com.android.server.usage.IntervalStats for the given range and interval type. ...</div><div class='long'><p>Find all <a href=\"#!/api/com.android.server.usage.IntervalStats\" rel=\"com.android.server.usage.IntervalStats\" class=\"docClass\">com.android.server.usage.IntervalStats</a> for the given range and interval type.</p>\n</div></div></div></div></div></div></div>","meta":{}});