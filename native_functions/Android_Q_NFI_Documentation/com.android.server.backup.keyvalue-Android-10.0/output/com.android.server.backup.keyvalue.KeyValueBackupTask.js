Ext.data.JsonP.com_android_server_backup_keyvalue_KeyValueBackupTask({"tagname":"class","name":"com.android.server.backup.keyvalue.KeyValueBackupTask","autodetected":{},"files":[{"filename":"KeyValueBackupTask.js","href":"KeyValueBackupTask.html#com-android-server-backup-keyvalue-KeyValueBackupTask"}],"extends":"java.lang.Object","members":[{"name":"NEW_STATE_FILE_SUFFIX","tagname":"property","owner":"com.android.server.backup.keyvalue.KeyValueBackupTask","id":"property-NEW_STATE_FILE_SUFFIX","meta":{}},{"name":"STAGING_FILE_SUFFIX","tagname":"property","owner":"com.android.server.backup.keyvalue.KeyValueBackupTask","id":"property-STAGING_FILE_SUFFIX","meta":{}},{"name":"execute","tagname":"method","owner":"com.android.server.backup.keyvalue.KeyValueBackupTask","id":"method-execute","meta":{}},{"name":"handleCancel","tagname":"method","owner":"com.android.server.backup.keyvalue.KeyValueBackupTask","id":"method-handleCancel","meta":{}},{"name":"markCancel","tagname":"method","owner":"com.android.server.backup.keyvalue.KeyValueBackupTask","id":"method-markCancel","meta":{}},{"name":"operationComplete","tagname":"method","owner":"com.android.server.backup.keyvalue.KeyValueBackupTask","id":"method-operationComplete","meta":{}},{"name":"run","tagname":"method","owner":"com.android.server.backup.keyvalue.KeyValueBackupTask","id":"method-run","meta":{}},{"name":"start","tagname":"method","owner":"com.android.server.backup.keyvalue.KeyValueBackupTask","id":"method-start","meta":{}},{"name":"waitCancel","tagname":"method","owner":"com.android.server.backup.keyvalue.KeyValueBackupTask","id":"method-waitCancel","meta":{}}],"alternateClassNames":[],"aliases":{},"id":"class-com.android.server.backup.keyvalue.KeyValueBackupTask","short_doc":"implements com.android.server.backup.BackupRestoreTask\n\n implements java.lang.Runnable\n\nRepresents the task of perfor...","classIcon":"icon-class","superclasses":["java.lang.Object"],"subclasses":[],"mixedInto":[],"mixins":[],"parentMixins":[],"requires":[],"uses":[],"html":"<div><pre class=\"hierarchy\"><h4>Hierarchy</h4><div class='subclass first-child'>java.lang.Object<div class='subclass '><strong>com.android.server.backup.keyvalue.KeyValueBackupTask</strong></div></div><h4>Files</h4><div class='dependency'><a href='source/KeyValueBackupTask.html#com-android-server-backup-keyvalue-KeyValueBackupTask' target='_blank'>KeyValueBackupTask.js</a></div></pre><div class='doc-contents'><p>implements com.android.server.backup.BackupRestoreTask</p>\n\n<p> implements java.lang.Runnable</p>\n\n<p>Represents the task of performing a sequence of key-value backups for a given list of packages.\n Method <a href=\"#!/api/com.android.server.backup.keyvalue.KeyValueBackupTask-method-run\" rel=\"com.android.server.backup.keyvalue.KeyValueBackupTask-method-run\" class=\"docClass\">run</a>() executes the backups to the transport specified via the {@code\n transportClient} parameter in the constructor.</p>\n\n<p> <p>A few definitions:</p>\n\n<p> <ul>\n   <li>State directory: UserBackupManagerService.getBaseStateDir()/&lt;transport&gt;\n   <li>State file: UserBackupManagerService.getBaseStateDir()/&lt;transport&gt;/&lt;package&gt;<br>\n       Represents the state of the backup data for a specific package in the current dataset.\n   <li>Stage directory: UserBackupManagerService.getDataDir()\n   <li>Stage file: UserBackupManagerService.getDataDir()/&lt;package&gt;.data<br>\n       Contains staged data that the agents wrote via BackupDataOutput, to be transmitted\n       to the transport.\n </li></li></li></li></ul></p>\n\n<p> If there is no PackageManager (PM) pseudo-package state file in the state directory, the\n specified transport will be initialized with IBackupTransport.initializeDevice().</p>\n\n<p> <p>The PM pseudo-package is the first package to be backed-up and sent to the transport in case\n of incremental choice. If non-incremental, PM will only be backed-up if specified in the queue,\n and if it's the case it will be re-positioned at the head of the queue.</p>\n\n<p> <p>Before starting, this task will register itself in UserBackupManagerService current\n operations.</p>\n\n<p> <p>In summary, this task will for each package:</p>\n\n<p> <ul>\n   <li>Bind to its IBackupAgent.\n   <li>Request transport quota and flags.\n   <li>Call ParcelFileDescriptor,\n       ParcelFileDescriptor, long, IBackupCallback, int) via RemoteCall passing the\n       old state file descriptor (read), the backup data file descriptor (write), the new state\n       file descriptor (write), the quota and the transport flags. This will call BackupDataOutput, ParcelFileDescriptor) with\n       the old state file to be read, a BackupDataOutput object to write the backup data\n       and the new state file to write. By writing to BackupDataOutput, the agent will\n       write data to the stage file. The task will block waiting for either:\n       <ul>\n         <li>Agent response.\n         <li>Agent time-out (specified via UserBackupManagerService.getAgentTimeoutParameters().\n         <li>External cancellation or thread interrupt.\n       </li></li></li></ul>\n   <li>Unbind the agent.\n   <li>Assuming agent response, send the staged data that the agent wrote to disk to the transport\n       via ParcelFileDescriptor, int).\n   <li>Call IBackupTransport.finishBackup() if previous call was successful.\n   <li>Save the new state in the state file. During the agent call it was being written to\n       &lt;state file&gt;.new, here we rename it and replace the old one.\n   <li>Delete the stage file.\n </li></li></li></li></li></li></li></li></ul></p>\n\n<p> In the end, this task will:</p>\n\n<p> <ul>\n   <li>Mark data-changed for the remaining packages in the queue (skipped packages).\n   <li>Delete the DataChangedJournal provided. Note that this should not be the current\n       journal.\n   <li>Set UserBackupManagerService current token as IBackupTransport.getCurrentRestoreSet(), if applicable.\n   <li>Add the transport to the list of transports pending initialization (UserBackupManagerService.getPendingInits()) and kick-off initialization if the transport\n       ever returned BackupTransport.TRANSPORT_NOT_INITIALIZED.\n   <li>Unregister the task in current operations.\n   <li>Release the wakelock.\n   <li>Kick-off PerformFullTransportBackupTask if a list of full-backup packages was\n       provided.\n </li></li></li></li></li></li></li></ul></p>\n\n<p> The caller can specify whether this should be an incremental or non-incremental backup. In the\n case of non-incremental the agents will be passed an empty old state file, which signals that a\n complete backup should be performed.</p>\n\n<p> <p>This task is designed to run on a dedicated thread, with the exception of the <a href=\"#!/api/com.android.server.backup.keyvalue.KeyValueBackupTask-method-handleCancel\" rel=\"com.android.server.backup.keyvalue.KeyValueBackupTask-method-handleCancel\" class=\"docClass\">handleCancel</a>(boolean) method, which can be called from any thread.</p>\n</div><div class='members'><div class='members-section'><div class='definedBy'>Defined By</div><h3 class='members-title icon-property'>Properties</h3><div class='subsection'><div id='property-NEW_STATE_FILE_SUFFIX' class='member first-child not-inherited'><a href='#' class='side expandable'><span>&nbsp;</span></a><div class='title'><div class='meta'><span class='defined-in' rel='com.android.server.backup.keyvalue.KeyValueBackupTask'>com.android.server.backup.keyvalue.KeyValueBackupTask</span><br/><a href='source/KeyValueBackupTask.html#com-android-server-backup-keyvalue-KeyValueBackupTask-property-NEW_STATE_FILE_SUFFIX' target='_blank' class='view-source'>view source</a></div><a href='#!/api/com.android.server.backup.keyvalue.KeyValueBackupTask-property-NEW_STATE_FILE_SUFFIX' class='name expandable'>NEW_STATE_FILE_SUFFIX</a> : String<span class=\"signature\"></span></div><div class='description'><div class='short'> ...</div><div class='long'>\n<p>Defaults to: <code>&quot;.new&quot;</code></p></div></div></div><div id='property-STAGING_FILE_SUFFIX' class='member  not-inherited'><a href='#' class='side expandable'><span>&nbsp;</span></a><div class='title'><div class='meta'><span class='defined-in' rel='com.android.server.backup.keyvalue.KeyValueBackupTask'>com.android.server.backup.keyvalue.KeyValueBackupTask</span><br/><a href='source/KeyValueBackupTask.html#com-android-server-backup-keyvalue-KeyValueBackupTask-property-STAGING_FILE_SUFFIX' target='_blank' class='view-source'>view source</a></div><a href='#!/api/com.android.server.backup.keyvalue.KeyValueBackupTask-property-STAGING_FILE_SUFFIX' class='name expandable'>STAGING_FILE_SUFFIX</a> : String<span class=\"signature\"></span></div><div class='description'><div class='short'> ...</div><div class='long'>\n<p>Defaults to: <code>&quot;.data&quot;</code></p></div></div></div></div></div><div class='members-section'><div class='definedBy'>Defined By</div><h3 class='members-title icon-method'>Methods</h3><div class='subsection'><div id='method-execute' class='member first-child not-inherited'><a href='#' class='side expandable'><span>&nbsp;</span></a><div class='title'><div class='meta'><span class='defined-in' rel='com.android.server.backup.keyvalue.KeyValueBackupTask'>com.android.server.backup.keyvalue.KeyValueBackupTask</span><br/><a href='source/KeyValueBackupTask.html#com-android-server-backup-keyvalue-KeyValueBackupTask-method-execute' target='_blank' class='view-source'>view source</a></div><a href='#!/api/com.android.server.backup.keyvalue.KeyValueBackupTask-method-execute' class='name expandable'>execute</a>( <span class='pre'></span> )<span class=\"signature\"></span></div><div class='description'><div class='short'> ...</div><div class='long'>\n</div></div></div><div id='method-handleCancel' class='member  not-inherited'><a href='#' class='side expandable'><span>&nbsp;</span></a><div class='title'><div class='meta'><span class='defined-in' rel='com.android.server.backup.keyvalue.KeyValueBackupTask'>com.android.server.backup.keyvalue.KeyValueBackupTask</span><br/><a href='source/KeyValueBackupTask.html#com-android-server-backup-keyvalue-KeyValueBackupTask-method-handleCancel' target='_blank' class='view-source'>view source</a></div><a href='#!/api/com.android.server.backup.keyvalue.KeyValueBackupTask-method-handleCancel' class='name expandable'>handleCancel</a>( <span class='pre'>cancelAll</span> )<span class=\"signature\"></span></div><div class='description'><div class='short'>Cancels this task. ...</div><div class='long'><p>Cancels this task.</p>\n\n<p> <p>After this method returns this task won't be registered in BackupManagerService\n anymore, which means there will be no backups running unless there is a racy request\n coming from another thread in between. As a consequence there will be no more calls to the\n transport originated from this task.</p>\n\n<p> <p>If this method is executed while an agent is performing a backup, we will stop waiting for\n it, disregard its backup data and finalize the task. However, if this method is executed in\n between agent calls, the backup data of the last called agent will be sent to\n the transport and we will not consider the next agent (nor the rest of the queue), proceeding\n to finalize the backup.</p>\n\n<p> <p>Note: This method is inherently racy since there are no guarantees about how much of the\n task will be executed after you made the call.</p>\n<h3 class=\"pa\">Parameters</h3><ul><li><span class='pre'>cancelAll</span> : Boolean<div class='sub-desc'><p>MUST be {@code true}. Will be removed.</p>\n</div></li></ul></div></div></div><div id='method-markCancel' class='member  not-inherited'><a href='#' class='side expandable'><span>&nbsp;</span></a><div class='title'><div class='meta'><span class='defined-in' rel='com.android.server.backup.keyvalue.KeyValueBackupTask'>com.android.server.backup.keyvalue.KeyValueBackupTask</span><br/><a href='source/KeyValueBackupTask.html#com-android-server-backup-keyvalue-KeyValueBackupTask-method-markCancel' target='_blank' class='view-source'>view source</a></div><a href='#!/api/com.android.server.backup.keyvalue.KeyValueBackupTask-method-markCancel' class='name expandable'>markCancel</a>( <span class='pre'></span> )<span class=\"signature\"></span></div><div class='description'><div class='short'>Marks this task as cancelled and tries to stop any ongoing agent call. ...</div><div class='long'><p>Marks this task as cancelled and tries to stop any ongoing agent call.</p>\n</div></div></div><div id='method-operationComplete' class='member  not-inherited'><a href='#' class='side expandable'><span>&nbsp;</span></a><div class='title'><div class='meta'><span class='defined-in' rel='com.android.server.backup.keyvalue.KeyValueBackupTask'>com.android.server.backup.keyvalue.KeyValueBackupTask</span><br/><a href='source/KeyValueBackupTask.html#com-android-server-backup-keyvalue-KeyValueBackupTask-method-operationComplete' target='_blank' class='view-source'>view source</a></div><a href='#!/api/com.android.server.backup.keyvalue.KeyValueBackupTask-method-operationComplete' class='name expandable'>operationComplete</a>( <span class='pre'></span> )<span class=\"signature\"></span></div><div class='description'><div class='short'> ...</div><div class='long'>\n</div></div></div><div id='method-run' class='member  not-inherited'><a href='#' class='side expandable'><span>&nbsp;</span></a><div class='title'><div class='meta'><span class='defined-in' rel='com.android.server.backup.keyvalue.KeyValueBackupTask'>com.android.server.backup.keyvalue.KeyValueBackupTask</span><br/><a href='source/KeyValueBackupTask.html#com-android-server-backup-keyvalue-KeyValueBackupTask-method-run' target='_blank' class='view-source'>view source</a></div><a href='#!/api/com.android.server.backup.keyvalue.KeyValueBackupTask-method-run' class='name expandable'>run</a>( <span class='pre'></span> )<span class=\"signature\"></span></div><div class='description'><div class='short'> ...</div><div class='long'>\n</div></div></div><div id='method-start' class='member  not-inherited'><a href='#' class='side expandable'><span>&nbsp;</span></a><div class='title'><div class='meta'><span class='defined-in' rel='com.android.server.backup.keyvalue.KeyValueBackupTask'>com.android.server.backup.keyvalue.KeyValueBackupTask</span><br/><a href='source/KeyValueBackupTask.html#com-android-server-backup-keyvalue-KeyValueBackupTask-method-start' target='_blank' class='view-source'>view source</a></div><a href='#!/api/com.android.server.backup.keyvalue.KeyValueBackupTask-method-start' class='name expandable'>start</a>( <span class='pre'>backupManagerService, transportClient, transportDirName, queue, dataChangedJournal, observer, monitor, listener, pendingFullBackups, userInitiated, nonIncremental</span> ) : Object {com.android.server.backup.keyvalue.KeyValueBackupTask}<span class=\"signature\"></span></div><div class='description'><div class='short'>Creates a new com.android.server.backup.keyvalue.KeyValueBackupTask for key-value backup operation, spins up a new\n d...</div><div class='long'><p>Creates a new <a href=\"#!/api/com.android.server.backup.keyvalue.KeyValueBackupTask\" rel=\"com.android.server.backup.keyvalue.KeyValueBackupTask\" class=\"docClass\">com.android.server.backup.keyvalue.KeyValueBackupTask</a> for key-value backup operation, spins up a new\n dedicated thread and kicks off the operation in it.</p>\n<h3 class=\"pa\">Parameters</h3><ul><li><span class='pre'>backupManagerService</span> : Object {UserBackupManagerService}<div class='sub-desc'><p>The UserBackupManagerService instance.</p>\n</div></li><li><span class='pre'>transportClient</span> : Object {TransportClient}<div class='sub-desc'><p>The TransportClient that contains the transport used for the\n     operation.</p>\n</div></li><li><span class='pre'>transportDirName</span> : String<div class='sub-desc'><p>The value of IBackupTransport.transportDirName() for the\n     transport whose TransportClient was provided above.</p>\n</div></li><li><span class='pre'>queue</span> : Object {java.util.List}<div class='sub-desc'><p>The list of package names that will be backed-up.</p>\n</div></li><li><span class='pre'>dataChangedJournal</span> : Object {DataChangedJournal}<div class='sub-desc'><p>The old data-changed journal file that will be deleted when the\n     operation finishes (successfully or not) or {@code null}.</p>\n</div></li><li><span class='pre'>observer</span> : Object {IBackupObserver}<div class='sub-desc'><p>A IBackupObserver.</p>\n</div></li><li><span class='pre'>monitor</span> : Object {IBackupManagerMonitor}<div class='sub-desc'><p>A IBackupManagerMonitor.</p>\n</div></li><li><span class='pre'>listener</span> : Object {OnTaskFinishedListener}<div class='sub-desc'><p>A OnTaskFinishedListener or {@code null}.</p>\n</div></li><li><span class='pre'>pendingFullBackups</span> : Object {java.util.List}<div class='sub-desc'><p>The list of packages that will be passed for a new PerformFullTransportBackupTask operation, which will be started when this finishes.</p>\n</div></li><li><span class='pre'>userInitiated</span> : Boolean<div class='sub-desc'><p>Whether this was user-initiated or not.</p>\n</div></li><li><span class='pre'>nonIncremental</span> : Boolean<div class='sub-desc'><p>If {@code true}, this will be a complete backup for each package,\n     otherwise it will be just an incremental one over the current dataset.</p>\n</div></li></ul><h3 class='pa'>Returns</h3><ul><li><span class='pre'>Object {com.android.server.backup.keyvalue.KeyValueBackupTask}</span><div class='sub-desc'><p>The KeyValueBackupTask that was started.</p>\n</div></li></ul></div></div></div><div id='method-waitCancel' class='member  not-inherited'><a href='#' class='side expandable'><span>&nbsp;</span></a><div class='title'><div class='meta'><span class='defined-in' rel='com.android.server.backup.keyvalue.KeyValueBackupTask'>com.android.server.backup.keyvalue.KeyValueBackupTask</span><br/><a href='source/KeyValueBackupTask.html#com-android-server-backup-keyvalue-KeyValueBackupTask-method-waitCancel' target='_blank' class='view-source'>view source</a></div><a href='#!/api/com.android.server.backup.keyvalue.KeyValueBackupTask-method-waitCancel' class='name expandable'>waitCancel</a>( <span class='pre'></span> )<span class=\"signature\"></span></div><div class='description'><div class='short'>Waits for this task to be cancelled after call to markCancel(). ...</div><div class='long'><p>Waits for this task to be cancelled after call to <a href=\"#!/api/com.android.server.backup.keyvalue.KeyValueBackupTask-method-markCancel\" rel=\"com.android.server.backup.keyvalue.KeyValueBackupTask-method-markCancel\" class=\"docClass\">markCancel</a>().</p>\n</div></div></div></div></div></div></div>","meta":{}});